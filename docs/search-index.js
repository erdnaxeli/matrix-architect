crystal_doc_search_index_callback({"repository_name":"matrix-architect","body":"# matrix-architect\n\nA bot to manage your Synapse home server.\nIt uses Synapse's [admin API](https://github.com/matrix-org/synapse/tree/master/docs/admin_api)\nto provides management commands.\n\nCurrent state of API implementation:\n* [ ] account_validity\n* [ ] delete_group\n* [ ] media_admin_api\n* [ ] purge_history_api\n* [ ] purge_remote_media\n* [x] purge_room\n  * `!room purge <room id>`\n  * `!room garbage-collect`\n* [ ] register_api\n* [ ] room_membership\n* [x] rooms\n  * `!room count`\n  * `!room details <room id>`\n  * `!room list`\n  * `!room top-complexity`\n  * `!room top-members`\n* [ ] server_notices\n* [x] shutdown_room\n  * `!room shutdown <room id>`\n* [x] user_admin_api\n  * `!user list`\n  * `!user query <user id>`\n  * `!user deactivate <user id>`\n  * `!user reset-password <user id>`\n* [x] version_api\n  * `!version`\n\nSee `!help` for more details about the bot's commands.\n\n## Installation\n\nYou can download a static build from the [releases](https://github.com/erdnaxeli/matrix-architect/releases) page.\n\nIf you want to build it yourself you need to [install Crystal](https://crystal-lang.org/install/) 0.34, then clone the code, go to the new folder and:\n\n```\nmake\n```\n\nYou can also build a static binary with\n```\nmake static\n```\n\nNote that the static build (manually or from the releases) is not actually totally\nstatic (see the [Cristal wiki](https://github.com/crystal-lang/crystal/wiki/Static-Linking)).\nIf you have trouble you want prefer to build yourself a not static binary.\n\n## Usage\n\nSetting the configuration:\n\n1. Create a new account for the bot on your HS, with your favorite client\n2. Log out (to discard any e2e key that would have been created)\n3. Use the script `tools/get_access_token.sh` to get a new access_token for the bot\n4. Set the new created account as\n[admin](https://github.com/matrix-org/synapse/tree/master/docs/admin_api).\n5. Copy the `config-example.yml` file to `config.yml` and fill the values\n\nRun the bot with `./matrix-architect`. If you let the log level to \"info\" you should\nsee some messages.\n\nYou can now talk to the bot on Matrix!\n\n## Contributing\n\n1. Fork it (<https://github.com/erdnaxeli/matrix-architect/fork>)\n2. Create your feature branch (`git checkout -b my-new-feature`)\n3. Commit your changes (`git commit -am 'Add some feature'`)\n4. Push to the branch (`git push origin my-new-feature`)\n5. Create a new Pull Request\n\nDon't forget to run `crystal tool format` on any code you commit.\n\nYour are advised to open an issue before opening a pull request.\nIn that issue you can describe the context and discuss your proposal.\n\n## TODO\n\nNon ordered list of things I would like to do:\n\n* Implement more API commands:\nI am not sure we need all the admin API available though the bot, but it's sure we need more.\n* Implement new commands:\nthere is probably space to implement new commands that combine different APIs,\nlike the garbage-collect one.\n* Provide administration for bridges? That could be something useful.\n* Give some love to the cli executable:\n  * implement account creation in the main executable\n  * implement config generation\n  * read the config file from well known places or cli parameter\n* Test the code\n\n## Contributors\n\n- [erdnaxeli](https://github.com/erdnaxeli) - creator and maintainer\n","program":{"html_id":"matrix-architect/toplevel","path":"toplevel.html","kind":"module","full_name":"Top Level Namespace","name":"Top Level Namespace","abstract":false,"superclass":null,"ancestors":[],"locations":[],"repository_name":"matrix-architect","program":true,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":null,"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[],"macros":[],"types":[{"html_id":"matrix-architect/Matrix","path":"Matrix.html","kind":"module","full_name":"Matrix","name":"Matrix","abstract":false,"superclass":null,"ancestors":[],"locations":[],"repository_name":"matrix-architect","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":null,"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[],"macros":[],"types":[{"html_id":"matrix-architect/Matrix/Architect","path":"Matrix/Architect.html","kind":"module","full_name":"Matrix::Architect","name":"Architect","abstract":false,"superclass":null,"ancestors":[],"locations":[],"repository_name":"matrix-architect","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[{"id":"Log","name":"Log","value":"::Log.for(self)","doc":null,"summary":null},{"id":"VERSION","name":"VERSION","value":"\"0.1.0\"","doc":null,"summary":null}],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"matrix-architect/Matrix","kind":"module","full_name":"Matrix","name":"Matrix"},"doc":null,"summary":null,"class_methods":[{"id":"get_config-class-method","html_id":"get_config-class-method","name":"get_config","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"","source_link":null,"def":{"name":"get_config","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"begin\n  File.open(\"config.yml\") do |file|\n    return Config.from_yaml(file)\n  end\nrescue File::NotFoundError\n  puts(\"Configuration file 'config.yml' not found\")\nrescue ex : YAML::ParseException\n  puts(\"Error while reading config file: #{ex.message}\")\nend"}},{"id":"run-class-method","html_id":"run-class-method","name":"run","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"","source_link":null,"def":{"name":"run","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"config = get_config\nif !config.nil?\n  ::Log.setup(config.log_level)\n  (Bot.new(config)).run\nend\n"}}],"constructors":[],"instance_methods":[],"macros":[],"types":[{"html_id":"matrix-architect/Matrix/Architect/Bot","path":"Matrix/Architect/Bot.html","kind":"class","full_name":"Matrix::Architect::Bot","name":"Bot","abstract":false,"superclass":{"html_id":"matrix-architect/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"matrix-architect/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"matrix-architect/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[],"repository_name":"matrix-architect","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[{"id":"Log","name":"Log","value":"Matrix::Architect::Log.for(self)","doc":null,"summary":null}],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"matrix-architect/Matrix/Architect","kind":"module","full_name":"Matrix::Architect","name":"Architect"},"doc":null,"summary":null,"class_methods":[],"constructors":[{"id":"new(config:Config)-class-method","html_id":"new(config:Config)-class-method","name":"new","doc":null,"summary":null,"abstract":false,"args":[{"name":"config","doc":null,"default_value":"","external_name":"config","restriction":"Config"}],"args_string":"(config : Config)","source_link":null,"def":{"name":"new","args":[{"name":"config","doc":null,"default_value":"","external_name":"config","restriction":"Config"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"_ = allocate\n_.initialize(config)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"id":"exec_command(message,event):Nil-instance-method","html_id":"exec_command(message,event):Nil-instance-method","name":"exec_command","doc":null,"summary":null,"abstract":false,"args":[{"name":"message","doc":null,"default_value":"","external_name":"message","restriction":""},{"name":"event","doc":null,"default_value":"","external_name":"event","restriction":""}],"args_string":"(message, event) : Nil","source_link":null,"def":{"name":"exec_command","args":[{"name":"message","doc":null,"default_value":"","external_name":"message","restriction":""},{"name":"event","doc":null,"default_value":"","external_name":"event","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Nil","visibility":"Public","body":"begin\n  Commands.run(message.body, event.room_id, @conn)\nrescue ex : Exception\n  Log.error(exception: ex) do\n    \"Error while executing command \\\"#{message.body}\\\"\"\n  end\nend"}},{"id":"run:Nil-instance-method","html_id":"run:Nil-instance-method","name":"run","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : Nil","source_link":null,"def":{"name":"run","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Nil","visibility":"Public","body":"first_sync = true\nchannel = Channel(Events::Sync).new\n@conn.sync(channel)\nloop do\n  sync = channel.receive\n  sync.invites do |invite|\n    begin\n      @conn.join(invite.room_id)\n    rescue Connection::ExecError\n    end\n  end\n  if first_sync\n    first_sync = false\n    next\n  end\n  sync.room_events do |event|\n    if ((message = event.message?) && (event.sender != @conn.user_id)) && (@config.users_id.includes?(event.sender))\n      spawn(exec_command(message, event))\n    end\n  end\nend\n"}}],"macros":[],"types":[]},{"html_id":"matrix-architect/Matrix/Architect/Commands","path":"Matrix/Architect/Commands.html","kind":"module","full_name":"Matrix::Architect::Commands","name":"Commands","abstract":false,"superclass":null,"ancestors":[],"locations":[],"repository_name":"matrix-architect","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"matrix-architect/Matrix/Architect","kind":"module","full_name":"Matrix::Architect","name":"Architect"},"doc":null,"summary":null,"class_methods":[{"id":"run(line,room_id,conn):Nil-class-method","html_id":"run(line,room_id,conn):Nil-class-method","name":"run","doc":null,"summary":null,"abstract":false,"args":[{"name":"line","doc":null,"default_value":"","external_name":"line","restriction":""},{"name":"room_id","doc":null,"default_value":"","external_name":"room_id","restriction":""},{"name":"conn","doc":null,"default_value":"","external_name":"conn","restriction":""}],"args_string":"(line, room_id, conn) : Nil","source_link":null,"def":{"name":"run","args":[{"name":"line","doc":null,"default_value":"","external_name":"line","restriction":""},{"name":"room_id","doc":null,"default_value":"","external_name":"room_id","restriction":""},{"name":"conn","doc":null,"default_value":"","external_name":"conn","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Nil","visibility":"Public","body":"args = (line.split(\" \")).reject do |v|\n  v == \"\"\nend\ncommand = args.shift\ncase command\nwhen \"!help\"\n  msg = String.build do |str|\n    str << \"!help\\n  Display this help.\\n\"\n    Room.usage(str)\n    User.usage(str)\n    Version.usage(str)\n  end\n  conn.send_message(room_id, msg)\nwhen \"!room\"\n  Room.run(args, room_id, conn)\nwhen \"!user\"\n  User.run(args, room_id, conn)\nwhen \"!version\"\n  Version.run(args, room_id, conn)\nelse\nend\n"}}],"constructors":[],"instance_methods":[],"macros":[],"types":[{"html_id":"matrix-architect/Matrix/Architect/Commands/Base","path":"Matrix/Architect/Commands/Base.html","kind":"class","full_name":"Matrix::Architect::Commands::Base","name":"Base","abstract":false,"superclass":{"html_id":"matrix-architect/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"matrix-architect/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"matrix-architect/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[],"repository_name":"matrix-architect","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[{"html_id":"matrix-architect/Matrix/Architect/Commands/Room","kind":"class","full_name":"Matrix::Architect::Commands::Room","name":"Room"}],"including_types":[],"namespace":{"html_id":"matrix-architect/Matrix/Architect/Commands","kind":"module","full_name":"Matrix::Architect::Commands","name":"Commands"},"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[{"id":"run_with_progress(progress_wait:Time::Span,&)-instance-method","html_id":"run_with_progress(progress_wait:Time::Span,&)-instance-method","name":"run_with_progress","doc":"Runs a command and exec some block on success and progress.\n\nYield a `Runner` object. *progress_wait* is the time to wait between\nexecution of the progress callback.\n\n```\nrun_with_progress(10) do |runner|\n  runner.command { puts \"I am starting\"; sleep 25; puts \"I am working\" }\n  runner.on_progress { |s| puts \"I am waiting #{s}\" }\n  runner.on_success { |s| puts \"I am done #{s}\" }\nend\n```\n\nThe above produce\n\n```text\nI am starting\nI am waiting 10\nI am waiting 20\nI am working\nI am done 25\n```","summary":"<p>Runs a command and exec some block on success and progress.</p>","abstract":false,"args":[{"name":"progress_wait","doc":null,"default_value":"","external_name":"progress_wait","restriction":"Time::Span"}],"args_string":"(progress_wait : Time::Span, &)","source_link":null,"def":{"name":"run_with_progress","args":[{"name":"progress_wait","doc":null,"default_value":"","external_name":"progress_wait","restriction":"Time::Span"}],"double_splat":null,"splat_index":null,"yields":1,"block_arg":null,"return_type":"","visibility":"Public","body":"runner = Runner.new\nyield runner\nif runner.command_callback.nil?\n  raise(RunnerError.new(\"Missing command\"))\nend\nstart = Time.utc\ndone, error = Channel(Nil).new, Channel(Nil).new\nspawn do\n  begin\n    if command = runner.command_callback\n      command.call\n    end\n    done.close\n  rescue ex : Connection::ExecError\n    @conn.send_message(@room_id, \"Error: #{ex.message}\")\n    error.close\n  end\nend\nloop do\n  select\nwhen done.receive?\n    if on_success = runner.success_callback\n      on_success.call(Time.utc - start)\n    end\n    break\nwhen error.receive?\n    break\nwhen timeout(progress_wait)\n    if on_progress = runner.progress_callback\n      on_progress.call(Time.utc - start)\n    end\nend\n\nend\n"}}],"macros":[],"types":[{"html_id":"matrix-architect/Matrix/Architect/Commands/Base/Runner","path":"Matrix/Architect/Commands/Base/Runner.html","kind":"class","full_name":"Matrix::Architect::Commands::Base::Runner","name":"Runner","abstract":false,"superclass":{"html_id":"matrix-architect/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"matrix-architect/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"matrix-architect/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[],"repository_name":"matrix-architect","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"matrix-architect/Matrix/Architect/Commands/Base","kind":"class","full_name":"Matrix::Architect::Commands::Base","name":"Base"},"doc":" Configures the execution of a command. Used with `Base#run`.","summary":"<p> Configures the execution of a command.</p>","class_methods":[],"constructors":[],"instance_methods":[{"id":"command(&block)-instance-method","html_id":"command(&block)-instance-method","name":"command","doc":" Saves the command to run. If not set an error `RunError` wil be raised.","summary":"<p> Saves the command to run.</p>","abstract":false,"args":[],"args_string":"(&block)","source_link":null,"def":{"name":"command","args":[],"double_splat":null,"splat_index":null,"yields":0,"block_arg":{"name":"block","doc":null,"default_value":"","external_name":"block","restriction":""},"return_type":"","visibility":"Public","body":"@command_callback = block"}},{"id":"command_callback:->Nil?-instance-method","html_id":"command_callback:->Nil?-instance-method","name":"command_callback","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" :  -> Nil?","source_link":null,"def":{"name":"command_callback","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"@command_callback"}},{"id":"on_progress(&block:Time::Span->Nil)-instance-method","html_id":"on_progress(&block:Time::Span->Nil)-instance-method","name":"on_progress","doc":"Saves a proc to execute on command progression.\n\nWhen executing the proc, gives it the current execution time.","summary":"<p>Saves a proc to execute on command progression.</p>","abstract":false,"args":[],"args_string":"(&block : Time::Span -> Nil)","source_link":null,"def":{"name":"on_progress","args":[],"double_splat":null,"splat_index":null,"yields":1,"block_arg":{"name":"block","doc":null,"default_value":"","external_name":"block","restriction":"(Time::Span -> Nil)"},"return_type":"","visibility":"Public","body":"@progress_callback = block"}},{"id":"on_success(&block:Time::Span->Nil)-instance-method","html_id":"on_success(&block:Time::Span->Nil)-instance-method","name":"on_success","doc":"Saves a proc to execute on command success.\n\nWhen executing the proc, gives it the total execution time.","summary":"<p>Saves a proc to execute on command success.</p>","abstract":false,"args":[],"args_string":"(&block : Time::Span -> Nil)","source_link":null,"def":{"name":"on_success","args":[],"double_splat":null,"splat_index":null,"yields":1,"block_arg":{"name":"block","doc":null,"default_value":"","external_name":"block","restriction":"(Time::Span -> Nil)"},"return_type":"","visibility":"Public","body":"@success_callback = block"}},{"id":"progress_callback:Time::Span->Nil?-instance-method","html_id":"progress_callback:Time::Span->Nil?-instance-method","name":"progress_callback","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : Time::Span -> Nil?","source_link":null,"def":{"name":"progress_callback","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"@progress_callback"}},{"id":"success_callback:Time::Span->Nil?-instance-method","html_id":"success_callback:Time::Span->Nil?-instance-method","name":"success_callback","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : Time::Span -> Nil?","source_link":null,"def":{"name":"success_callback","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"@success_callback"}}],"macros":[],"types":[]}]},{"html_id":"matrix-architect/Matrix/Architect/Commands/Room","path":"Matrix/Architect/Commands/Room.html","kind":"class","full_name":"Matrix::Architect::Commands::Room","name":"Room","abstract":false,"superclass":{"html_id":"matrix-architect/Matrix/Architect/Commands/Base","kind":"class","full_name":"Matrix::Architect::Commands::Base","name":"Base"},"ancestors":[{"html_id":"matrix-architect/Matrix/Architect/Commands/Base","kind":"class","full_name":"Matrix::Architect::Commands::Base","name":"Base"},{"html_id":"matrix-architect/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"matrix-architect/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[],"repository_name":"matrix-architect","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"matrix-architect/Matrix/Architect/Commands","kind":"module","full_name":"Matrix::Architect::Commands","name":"Commands"},"doc":null,"summary":null,"class_methods":[{"id":"run(args,room_id,conn)-class-method","html_id":"run(args,room_id,conn)-class-method","name":"run","doc":null,"summary":null,"abstract":false,"args":[{"name":"args","doc":null,"default_value":"","external_name":"args","restriction":""},{"name":"room_id","doc":null,"default_value":"","external_name":"room_id","restriction":""},{"name":"conn","doc":null,"default_value":"","external_name":"conn","restriction":""}],"args_string":"(args, room_id, conn)","source_link":null,"def":{"name":"run","args":[{"name":"args","doc":null,"default_value":"","external_name":"args","restriction":""},{"name":"room_id","doc":null,"default_value":"","external_name":"room_id","restriction":""},{"name":"conn","doc":null,"default_value":"","external_name":"conn","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"(Room.new(room_id, conn)).run(args)"}},{"id":"usage(str)-class-method","html_id":"usage(str)-class-method","name":"usage","doc":null,"summary":null,"abstract":false,"args":[{"name":"str","doc":null,"default_value":"","external_name":"str","restriction":""}],"args_string":"(str)","source_link":null,"def":{"name":"usage","args":[{"name":"str","doc":null,"default_value":"","external_name":"str","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"str << \"!room count\\n  Return the total count of rooms.\\n!room details ROOM_ID\\n  Get all details about a room.\\n!room garbage-collect\\n  Purge all rooms without any local users joined.\\n!room list [--room-id FILTER]\\n  List rooms.\\n    --alias FILTER    filter on rooms's id\\n!room top-complexity\\n  Get top 10 rooms in complexity, aka state events number.\\n!room top-members\\n  Get top 10 rooms in number of members.\\n!room top-local-members\\n  Get top 10 rooms in number of local members.\\n!room purge ROOM_ID\\n  Remove all trace of a room from your database.\\n  All local users must have left the room before.\\n!room shutdown ROOM_ID\\n  Shutdown a room.\\n\""}}],"constructors":[{"id":"new(room_id:String,conn:Connection)-class-method","html_id":"new(room_id:String,conn:Connection)-class-method","name":"new","doc":null,"summary":null,"abstract":false,"args":[{"name":"room_id","doc":null,"default_value":"","external_name":"room_id","restriction":"String"},{"name":"conn","doc":null,"default_value":"","external_name":"conn","restriction":"Connection"}],"args_string":"(room_id : String, conn : Connection)","source_link":null,"def":{"name":"new","args":[{"name":"room_id","doc":null,"default_value":"","external_name":"room_id","restriction":"String"},{"name":"conn","doc":null,"default_value":"","external_name":"conn","restriction":"Connection"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"_ = allocate\n_.initialize(room_id, conn)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"id":"run(args):Nil-instance-method","html_id":"run(args):Nil-instance-method","name":"run","doc":null,"summary":null,"abstract":false,"args":[{"name":"args","doc":null,"default_value":"","external_name":"args","restriction":""}],"args_string":"(args) : Nil","source_link":null,"def":{"name":"run","args":[{"name":"args","doc":null,"default_value":"","external_name":"args","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Nil","visibility":"Public","body":"command = args.shift?\ncase command\nwhen \"count\"\n  count\nwhen \"details\"\n  details(args.pop?)\nwhen \"garbage-collect\"\n  garbage_collect\nwhen \"list\"\n  list(args)\nwhen \"top-complexity\"\n  top_rooms(Order::StateEvents)\nwhen \"top-local-members\"\n  top_rooms(Order::JoinedLocalMembers)\nwhen \"top-members\"\n  top_rooms(Order::JoinedMembers)\nwhen \"purge\"\n  purge(args.pop?)\nwhen \"shutdown\"\n  shutdown(args.pop?)\nelse\n  @conn.send_message(@room_id, \"Unknown command\")\nend\n"}}],"macros":[],"types":[{"html_id":"matrix-architect/Matrix/Architect/Commands/Room/Order","path":"Matrix/Architect/Commands/Room/Order.html","kind":"enum","full_name":"Matrix::Architect::Commands::Room::Order","name":"Order","abstract":false,"superclass":null,"ancestors":[{"html_id":"matrix-architect/Enum","kind":"struct","full_name":"Enum","name":"Enum"},{"html_id":"matrix-architect/Comparable","kind":"module","full_name":"Comparable","name":"Comparable"},{"html_id":"matrix-architect/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"matrix-architect/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[],"repository_name":"matrix-architect","program":false,"enum":true,"alias":false,"aliased":"","const":false,"constants":[{"id":"JoinedLocalMembers","name":"JoinedLocalMembers","value":"0","doc":null,"summary":null},{"id":"JoinedMembers","name":"JoinedMembers","value":"1","doc":null,"summary":null},{"id":"Name","name":"Name","value":"2","doc":null,"summary":null},{"id":"StateEvents","name":"StateEvents","value":"3","doc":null,"summary":null}],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"matrix-architect/Matrix/Architect/Commands/Room","kind":"class","full_name":"Matrix::Architect::Commands::Room","name":"Room"},"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[{"id":"joined_local_members?-instance-method","html_id":"joined_local_members?-instance-method","name":"joined_local_members?","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"","source_link":null,"def":{"name":"joined_local_members?","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"self == JoinedLocalMembers"}},{"id":"joined_members?-instance-method","html_id":"joined_members?-instance-method","name":"joined_members?","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"","source_link":null,"def":{"name":"joined_members?","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"self == JoinedMembers"}},{"id":"name?-instance-method","html_id":"name?-instance-method","name":"name?","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"","source_link":null,"def":{"name":"name?","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"self == Name"}},{"id":"state_events?-instance-method","html_id":"state_events?-instance-method","name":"state_events?","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"","source_link":null,"def":{"name":"state_events?","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"self == StateEvents"}},{"id":"to_s-instance-method","html_id":"to_s-instance-method","name":"to_s","doc":"Returns a `String` representation of this enum member.\nIn the case of regular enums, this is just the name of the member.\nIn the case of flag enums, it's the names joined by vertical bars, or \"None\",\nif the value is zero.\n\nIf an enum's value doesn't match a member's value, the raw value\nis returned as a string.\n\n```\nColor::Red.to_s                     # => \"Red\"\nIOMode::None.to_s                   # => \"None\"\n(IOMode::Read | IOMode::Write).to_s # => \"Read | Write\"\n\nColor.new(10).to_s # => \"10\"\n```","summary":"<p>Returns a <code>String</code> representation of this enum member.</p>","abstract":false,"args":[],"args_string":"","source_link":null,"def":{"name":"to_s","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"super().underscore"}}],"macros":[],"types":[]}]},{"html_id":"matrix-architect/Matrix/Architect/Commands/RunnerError","path":"Matrix/Architect/Commands/RunnerError.html","kind":"class","full_name":"Matrix::Architect::Commands::RunnerError","name":"RunnerError","abstract":false,"superclass":{"html_id":"matrix-architect/Exception","kind":"class","full_name":"Exception","name":"Exception"},"ancestors":[{"html_id":"matrix-architect/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"matrix-architect/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"matrix-architect/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[],"repository_name":"matrix-architect","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"matrix-architect/Matrix/Architect/Commands","kind":"module","full_name":"Matrix::Architect::Commands","name":"Commands"},"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[],"macros":[],"types":[]},{"html_id":"matrix-architect/Matrix/Architect/Commands/User","path":"Matrix/Architect/Commands/User.html","kind":"class","full_name":"Matrix::Architect::Commands::User","name":"User","abstract":false,"superclass":{"html_id":"matrix-architect/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"matrix-architect/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"matrix-architect/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[],"repository_name":"matrix-architect","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"matrix-architect/Matrix/Architect/Commands","kind":"module","full_name":"Matrix::Architect::Commands","name":"Commands"},"doc":null,"summary":null,"class_methods":[{"id":"run(args,room_id,conn)-class-method","html_id":"run(args,room_id,conn)-class-method","name":"run","doc":null,"summary":null,"abstract":false,"args":[{"name":"args","doc":null,"default_value":"","external_name":"args","restriction":""},{"name":"room_id","doc":null,"default_value":"","external_name":"room_id","restriction":""},{"name":"conn","doc":null,"default_value":"","external_name":"conn","restriction":""}],"args_string":"(args, room_id, conn)","source_link":null,"def":{"name":"run","args":[{"name":"args","doc":null,"default_value":"","external_name":"args","restriction":""},{"name":"room_id","doc":null,"default_value":"","external_name":"room_id","restriction":""},{"name":"conn","doc":null,"default_value":"","external_name":"conn","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"(User.new(room_id, conn)).run(args)"}},{"id":"usage(str)-class-method","html_id":"usage(str)-class-method","name":"usage","doc":null,"summary":null,"abstract":false,"args":[{"name":"str","doc":null,"default_value":"","external_name":"str","restriction":""}],"args_string":"(str)","source_link":null,"def":{"name":"usage","args":[{"name":"str","doc":null,"default_value":"","external_name":"str","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"str << \"!user deactivate USER_ID\\n  Deactive an account.\\n!user list [--no-guests] [--user-id FILTER]\\n  List users.\\n    --no-gests          do not list guests users\\n    --user-id FILTER    filter on users' id\\n!user reset-password [--no-logout] USER_ID\\n  Reset a user's password and return the new password.\\n    --no-logout         do not log the user out of all their devices\\n!user query USER_ID\\n  Return information about a specific user account.\\n\""}}],"constructors":[{"id":"new(room_id:String,conn:Connection)-class-method","html_id":"new(room_id:String,conn:Connection)-class-method","name":"new","doc":null,"summary":null,"abstract":false,"args":[{"name":"room_id","doc":null,"default_value":"","external_name":"room_id","restriction":"String"},{"name":"conn","doc":null,"default_value":"","external_name":"conn","restriction":"Connection"}],"args_string":"(room_id : String, conn : Connection)","source_link":null,"def":{"name":"new","args":[{"name":"room_id","doc":null,"default_value":"","external_name":"room_id","restriction":"String"},{"name":"conn","doc":null,"default_value":"","external_name":"conn","restriction":"Connection"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"_ = allocate\n_.initialize(room_id, conn)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"id":"run(args)-instance-method","html_id":"run(args)-instance-method","name":"run","doc":null,"summary":null,"abstract":false,"args":[{"name":"args","doc":null,"default_value":"","external_name":"args","restriction":""}],"args_string":"(args)","source_link":null,"def":{"name":"run","args":[{"name":"args","doc":null,"default_value":"","external_name":"args","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"command = args.shift?\nbegin\n  case command\n  when \"deactivate\"\n    deactivate(args)\n  when \"list\"\n    list(args)\n  when \"reset-password\"\n    reset_password(args)\n  when \"query\"\n    query(args)\n  else\n    @conn.send_message(@room_id, \"Unknown command\")\n  end\nrescue OptionParser::InvalidOption | OptionParser::MissingOption\n  usage = case command\n  when \"deactivate\"\n    deactivate_usage\n  when \"list\"\n    list_usage\n  when \"reset-password\"\n    reset_password_usage\n  when \"query\"\n    query_usage\n  else\n    \"unknown command\"\n  end\n  @conn.send_message(@room_id, \"Invalid command, usage: !user #{usage}\")\nend\n"}}],"macros":[],"types":[]},{"html_id":"matrix-architect/Matrix/Architect/Commands/Version","path":"Matrix/Architect/Commands/Version.html","kind":"module","full_name":"Matrix::Architect::Commands::Version","name":"Version","abstract":false,"superclass":null,"ancestors":[],"locations":[],"repository_name":"matrix-architect","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"matrix-architect/Matrix/Architect/Commands","kind":"module","full_name":"Matrix::Architect::Commands","name":"Commands"},"doc":null,"summary":null,"class_methods":[{"id":"run(args,room_id,conn)-class-method","html_id":"run(args,room_id,conn)-class-method","name":"run","doc":null,"summary":null,"abstract":false,"args":[{"name":"args","doc":null,"default_value":"","external_name":"args","restriction":""},{"name":"room_id","doc":null,"default_value":"","external_name":"room_id","restriction":""},{"name":"conn","doc":null,"default_value":"","external_name":"conn","restriction":""}],"args_string":"(args, room_id, conn)","source_link":null,"def":{"name":"run","args":[{"name":"args","doc":null,"default_value":"","external_name":"args","restriction":""},{"name":"room_id","doc":null,"default_value":"","external_name":"room_id","restriction":""},{"name":"conn","doc":null,"default_value":"","external_name":"conn","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"begin\n  response = conn.get(\"/v1/server_version\", is_admin: true)\nrescue ex : Connection::ExecError\n  conn.send_message(room_id, \"Error: #{ex.message}\")\nelse\n  msg = response.to_pretty_json\n  conn.send_message(room_id, \"```\\n#{msg}\\n```\", \"<pre>#{msg}</pre>\")\nend"}},{"id":"usage(str)-class-method","html_id":"usage(str)-class-method","name":"usage","doc":null,"summary":null,"abstract":false,"args":[{"name":"str","doc":null,"default_value":"","external_name":"str","restriction":""}],"args_string":"(str)","source_link":null,"def":{"name":"usage","args":[{"name":"str","doc":null,"default_value":"","external_name":"str","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"str << \"!version\\n  Get Synapse and Python versions.\\n\""}}],"constructors":[],"instance_methods":[],"macros":[],"types":[]}]},{"html_id":"matrix-architect/Matrix/Architect/Config","path":"Matrix/Architect/Config.html","kind":"struct","full_name":"Matrix::Architect::Config","name":"Config","abstract":false,"superclass":{"html_id":"matrix-architect/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"matrix-architect/YAML/Serializable/Strict","kind":"module","full_name":"YAML::Serializable::Strict","name":"Strict"},{"html_id":"matrix-architect/YAML/Serializable","kind":"module","full_name":"YAML::Serializable","name":"Serializable"},{"html_id":"matrix-architect/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"matrix-architect/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"matrix-architect/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[],"repository_name":"matrix-architect","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[{"html_id":"matrix-architect/YAML/Serializable","kind":"module","full_name":"YAML::Serializable","name":"Serializable"},{"html_id":"matrix-architect/YAML/Serializable/Strict","kind":"module","full_name":"YAML::Serializable::Strict","name":"Strict"}],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"matrix-architect/Matrix/Architect","kind":"module","full_name":"Matrix::Architect","name":"Architect"},"doc":null,"summary":null,"class_methods":[],"constructors":[{"id":"new(ctx:YAML::ParseContext,node:YAML::Nodes::Node)-class-method","html_id":"new(ctx:YAML::ParseContext,node:YAML::Nodes::Node)-class-method","name":"new","doc":null,"summary":null,"abstract":false,"args":[{"name":"ctx","doc":null,"default_value":"","external_name":"ctx","restriction":"YAML::ParseContext"},{"name":"node","doc":null,"default_value":"","external_name":"node","restriction":"YAML::Nodes::Node"}],"args_string":"(ctx : YAML::ParseContext, node : YAML::Nodes::Node)","source_link":null,"def":{"name":"new","args":[{"name":"ctx","doc":null,"default_value":"","external_name":"ctx","restriction":"YAML::ParseContext"},{"name":"node","doc":null,"default_value":"","external_name":"node","restriction":"YAML::Nodes::Node"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"new_from_yaml_node(ctx, node)"}}],"instance_methods":[{"id":"access_token:String-instance-method","html_id":"access_token:String-instance-method","name":"access_token","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : String","source_link":null,"def":{"name":"access_token","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"String","visibility":"Public","body":"@access_token"}},{"id":"access_token=(access_token:String)-instance-method","html_id":"access_token=(access_token:String)-instance-method","name":"access_token=","doc":null,"summary":null,"abstract":false,"args":[{"name":"access_token","doc":null,"default_value":"","external_name":"access_token","restriction":"String"}],"args_string":"(access_token : String)","source_link":null,"def":{"name":"access_token=","args":[{"name":"access_token","doc":null,"default_value":"","external_name":"access_token","restriction":"String"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"@access_token = access_token"}},{"id":"hs_url:String-instance-method","html_id":"hs_url:String-instance-method","name":"hs_url","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : String","source_link":null,"def":{"name":"hs_url","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"String","visibility":"Public","body":"@hs_url"}},{"id":"hs_url=(hs_url:String)-instance-method","html_id":"hs_url=(hs_url:String)-instance-method","name":"hs_url=","doc":null,"summary":null,"abstract":false,"args":[{"name":"hs_url","doc":null,"default_value":"","external_name":"hs_url","restriction":"String"}],"args_string":"(hs_url : String)","source_link":null,"def":{"name":"hs_url=","args":[{"name":"hs_url","doc":null,"default_value":"","external_name":"hs_url","restriction":"String"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"@hs_url = hs_url"}},{"id":"log_level:Log::Severity-instance-method","html_id":"log_level:Log::Severity-instance-method","name":"log_level","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : Log::Severity","source_link":null,"def":{"name":"log_level","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"@log_level"}},{"id":"log_level=(log_level)-instance-method","html_id":"log_level=(log_level)-instance-method","name":"log_level=","doc":null,"summary":null,"abstract":false,"args":[{"name":"log_level","doc":null,"default_value":"","external_name":"log_level","restriction":""}],"args_string":"(log_level)","source_link":null,"def":{"name":"log_level=","args":[{"name":"log_level","doc":null,"default_value":"","external_name":"log_level","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"@log_level = log_level"}},{"id":"users_id:Array(String)-instance-method","html_id":"users_id:Array(String)-instance-method","name":"users_id","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : Array(String)","source_link":null,"def":{"name":"users_id","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Array(String)","visibility":"Public","body":"@users_id"}},{"id":"users_id=(users_id:Array(String))-instance-method","html_id":"users_id=(users_id:Array(String))-instance-method","name":"users_id=","doc":null,"summary":null,"abstract":false,"args":[{"name":"users_id","doc":null,"default_value":"","external_name":"users_id","restriction":"Array(String)"}],"args_string":"(users_id : Array(String))","source_link":null,"def":{"name":"users_id=","args":[{"name":"users_id","doc":null,"default_value":"","external_name":"users_id","restriction":"Array(String)"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"@users_id = users_id"}}],"macros":[],"types":[]},{"html_id":"matrix-architect/Matrix/Architect/Connection","path":"Matrix/Architect/Connection.html","kind":"class","full_name":"Matrix::Architect::Connection","name":"Connection","abstract":false,"superclass":{"html_id":"matrix-architect/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"matrix-architect/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"matrix-architect/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[],"repository_name":"matrix-architect","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[{"id":"Log","name":"Log","value":"Matrix::Architect::Log.for(self)","doc":null,"summary":null}],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"matrix-architect/Matrix/Architect","kind":"module","full_name":"Matrix::Architect","name":"Architect"},"doc":null,"summary":null,"class_methods":[],"constructors":[{"id":"new(hs_url:String,access_token:String)-class-method","html_id":"new(hs_url:String,access_token:String)-class-method","name":"new","doc":null,"summary":null,"abstract":false,"args":[{"name":"hs_url","doc":null,"default_value":"","external_name":"hs_url","restriction":"String"},{"name":"access_token","doc":null,"default_value":"","external_name":"access_token","restriction":"String"}],"args_string":"(hs_url : String, access_token : String)","source_link":null,"def":{"name":"new","args":[{"name":"hs_url","doc":null,"default_value":"","external_name":"hs_url","restriction":"String"},{"name":"access_token","doc":null,"default_value":"","external_name":"access_token","restriction":"String"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"_ = allocate\n_.initialize(hs_url, access_token)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"id":"create_filter(filter):String-instance-method","html_id":"create_filter(filter):String-instance-method","name":"create_filter","doc":null,"summary":null,"abstract":false,"args":[{"name":"filter","doc":null,"default_value":"","external_name":"filter","restriction":""}],"args_string":"(filter) : String","source_link":null,"def":{"name":"create_filter","args":[{"name":"filter","doc":null,"default_value":"","external_name":"filter","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"String","visibility":"Public","body":"response = post(\"/user/#{@user_id}/filter\", filter)\nresponse[\"filter_id\"].as_s\n"}},{"id":"edit_message(room_id:String,event_id:String,message:String,html:String?=nil):Nil-instance-method","html_id":"edit_message(room_id:String,event_id:String,message:String,html:String?=nil):Nil-instance-method","name":"edit_message","doc":null,"summary":null,"abstract":false,"args":[{"name":"room_id","doc":null,"default_value":"","external_name":"room_id","restriction":"String"},{"name":"event_id","doc":null,"default_value":"","external_name":"event_id","restriction":"String"},{"name":"message","doc":null,"default_value":"","external_name":"message","restriction":"String"},{"name":"html","doc":null,"default_value":"nil","external_name":"html","restriction":"String | ::Nil"}],"args_string":"(room_id : String, event_id : String, message : String, html : String? = <span class=\"n\">nil</span>) : Nil","source_link":null,"def":{"name":"edit_message","args":[{"name":"room_id","doc":null,"default_value":"","external_name":"room_id","restriction":"String"},{"name":"event_id","doc":null,"default_value":"","external_name":"event_id","restriction":"String"},{"name":"message","doc":null,"default_value":"","external_name":"message","restriction":"String"},{"name":"html","doc":null,"default_value":"nil","external_name":"html","restriction":"String | ::Nil"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Nil","visibility":"Public","body":"tx_id = get_tx_id\nnew_content = get_message_content(message, html)\ndata = new_content.merge({\"m.new_content\": new_content, \"m.relates_to\": {rel_type: \"m.replace\", event_id: event_id}})\nput(\"/rooms/#{room_id}/send/m.room.message/#{tx_id}\", data)\n"}},{"id":"get(route,**options)-instance-method","html_id":"get(route,**options)-instance-method","name":"get","doc":null,"summary":null,"abstract":false,"args":[{"name":"route","doc":null,"default_value":"","external_name":"route","restriction":""}],"args_string":"(route, **options)","source_link":null,"def":{"name":"get","args":[{"name":"route","doc":null,"default_value":"","external_name":"route","restriction":""}],"double_splat":{"name":"options","doc":null,"default_value":"","external_name":"options","restriction":""},"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"exec(\"GET\", route, **options)"}},{"id":"join(room_id)-instance-method","html_id":"join(room_id)-instance-method","name":"join","doc":null,"summary":null,"abstract":false,"args":[{"name":"room_id","doc":null,"default_value":"","external_name":"room_id","restriction":""}],"args_string":"(room_id)","source_link":null,"def":{"name":"join","args":[{"name":"room_id","doc":null,"default_value":"","external_name":"room_id","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"post(\"/rooms/#{room_id}/join\")"}},{"id":"post(route,data=nil,**options)-instance-method","html_id":"post(route,data=nil,**options)-instance-method","name":"post","doc":null,"summary":null,"abstract":false,"args":[{"name":"route","doc":null,"default_value":"","external_name":"route","restriction":""},{"name":"data","doc":null,"default_value":"nil","external_name":"data","restriction":""}],"args_string":"(route, data = <span class=\"n\">nil</span>, **options)","source_link":null,"def":{"name":"post","args":[{"name":"route","doc":null,"default_value":"","external_name":"route","restriction":""},{"name":"data","doc":null,"default_value":"nil","external_name":"data","restriction":""}],"double_splat":{"name":"options","doc":null,"default_value":"","external_name":"options","restriction":""},"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"exec(\"POST\", route, **options, body: data)"}},{"id":"put(route,data=nil)-instance-method","html_id":"put(route,data=nil)-instance-method","name":"put","doc":null,"summary":null,"abstract":false,"args":[{"name":"route","doc":null,"default_value":"","external_name":"route","restriction":""},{"name":"data","doc":null,"default_value":"nil","external_name":"data","restriction":""}],"args_string":"(route, data = <span class=\"n\">nil</span>)","source_link":null,"def":{"name":"put","args":[{"name":"route","doc":null,"default_value":"","external_name":"route","restriction":""},{"name":"data","doc":null,"default_value":"nil","external_name":"data","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"exec(\"PUT\", route, body: data)"}},{"id":"send_message(room_id:String,message:String,html:String?=nil):String-instance-method","html_id":"send_message(room_id:String,message:String,html:String?=nil):String-instance-method","name":"send_message","doc":null,"summary":null,"abstract":false,"args":[{"name":"room_id","doc":null,"default_value":"","external_name":"room_id","restriction":"String"},{"name":"message","doc":null,"default_value":"","external_name":"message","restriction":"String"},{"name":"html","doc":null,"default_value":"nil","external_name":"html","restriction":"String | ::Nil"}],"args_string":"(room_id : String, message : String, html : String? = <span class=\"n\">nil</span>) : String","source_link":null,"def":{"name":"send_message","args":[{"name":"room_id","doc":null,"default_value":"","external_name":"room_id","restriction":"String"},{"name":"message","doc":null,"default_value":"","external_name":"message","restriction":"String"},{"name":"html","doc":null,"default_value":"nil","external_name":"html","restriction":"String | ::Nil"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"String","visibility":"Public","body":"tx_id = get_tx_id\ndata = get_message_content(message, html)\nresponse = put(\"/rooms/#{room_id}/send/m.room.message/#{tx_id}\", data)\nresponse[\"event_id\"].as_s\n"}},{"id":"sync(channel)-instance-method","html_id":"sync(channel)-instance-method","name":"sync","doc":null,"summary":null,"abstract":false,"args":[{"name":"channel","doc":null,"default_value":"","external_name":"channel","restriction":""}],"args_string":"(channel)","source_link":null,"def":{"name":"sync","args":[{"name":"channel","doc":null,"default_value":"","external_name":"channel","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"if @syncing\n  raise(Exception.new(\"Already syncing\"))\nend\nfilter = {account_data: {types: [] of String}, presence: {types: [] of String}, room: {account_data: {types: [] of String}, ephemeral: {types: [] of String}, timeline: {lazy_load_members: true}, state: {lazy_load_members: true}}}\nfilter_id = create_filter(filter)\nspawn do\n  next_batch = nil\n  loop do\n    begin\n      if next_batch.nil?\n        response = get(\"/sync\", is_sync: true, filter: filter_id)\n      else\n        response = get(\"/sync\", is_sync: true, filter: filter_id, since: next_batch, timeout: 300000)\n      end\n    rescue ex : ExecError\n      Log.error(exception: ex) do\n        \"Error while syncing, waiting 10s before retry\"\n      end\n      sleep(10)\n      next\n    end\n    next_batch = response[\"next_batch\"]?.try(&.to_s)\n    channel.send(Events::Sync.new(response))\n  end\nend\n"}},{"id":"user_id:String-instance-method","html_id":"user_id:String-instance-method","name":"user_id","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : String","source_link":null,"def":{"name":"user_id","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"String","visibility":"Public","body":"@user_id"}},{"id":"whoami:String-instance-method","html_id":"whoami:String-instance-method","name":"whoami","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : String","source_link":null,"def":{"name":"whoami","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"String","visibility":"Public","body":"response = get(\"/account/whoami\")\nresponse[\"user_id\"].as_s\n"}}],"macros":[],"types":[{"html_id":"matrix-architect/Matrix/Architect/Connection/ExecError","path":"Matrix/Architect/Connection/ExecError.html","kind":"class","full_name":"Matrix::Architect::Connection::ExecError","name":"ExecError","abstract":false,"superclass":{"html_id":"matrix-architect/Exception","kind":"class","full_name":"Exception","name":"Exception"},"ancestors":[{"html_id":"matrix-architect/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"matrix-architect/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"matrix-architect/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[],"repository_name":"matrix-architect","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"matrix-architect/Matrix/Architect/Connection","kind":"class","full_name":"Matrix::Architect::Connection","name":"Connection"},"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[],"macros":[],"types":[]}]},{"html_id":"matrix-architect/Matrix/Architect/Errors","path":"Matrix/Architect/Errors.html","kind":"module","full_name":"Matrix::Architect::Errors","name":"Errors","abstract":false,"superclass":null,"ancestors":[],"locations":[],"repository_name":"matrix-architect","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"matrix-architect/Matrix/Architect","kind":"module","full_name":"Matrix::Architect","name":"Architect"},"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[],"macros":[],"types":[{"html_id":"matrix-architect/Matrix/Architect/Errors/RateLimited","path":"Matrix/Architect/Errors/RateLimited.html","kind":"struct","full_name":"Matrix::Architect::Errors::RateLimited","name":"RateLimited","abstract":false,"superclass":{"html_id":"matrix-architect/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"matrix-architect/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"matrix-architect/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"matrix-architect/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[],"repository_name":"matrix-architect","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"matrix-architect/Matrix/Architect/Errors","kind":"module","full_name":"Matrix::Architect::Errors","name":"Errors"},"doc":null,"summary":null,"class_methods":[],"constructors":[{"id":"new(payload)-class-method","html_id":"new(payload)-class-method","name":"new","doc":null,"summary":null,"abstract":false,"args":[{"name":"payload","doc":null,"default_value":"","external_name":"payload","restriction":""}],"args_string":"(payload)","source_link":null,"def":{"name":"new","args":[{"name":"payload","doc":null,"default_value":"","external_name":"payload","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"_ = allocate\n_.initialize(payload)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"id":"retry_after_ms:Int32-instance-method","html_id":"retry_after_ms:Int32-instance-method","name":"retry_after_ms","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : Int32","source_link":null,"def":{"name":"retry_after_ms","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Int32","visibility":"Public","body":"@retry_after_ms"}}],"macros":[],"types":[]}]},{"html_id":"matrix-architect/Matrix/Architect/Events","path":"Matrix/Architect/Events.html","kind":"module","full_name":"Matrix::Architect::Events","name":"Events","abstract":false,"superclass":null,"ancestors":[],"locations":[],"repository_name":"matrix-architect","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"matrix-architect/Matrix/Architect","kind":"module","full_name":"Matrix::Architect","name":"Architect"},"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[],"macros":[],"types":[{"html_id":"matrix-architect/Matrix/Architect/Events/Invite","path":"Matrix/Architect/Events/Invite.html","kind":"struct","full_name":"Matrix::Architect::Events::Invite","name":"Invite","abstract":false,"superclass":{"html_id":"matrix-architect/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"matrix-architect/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"matrix-architect/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"matrix-architect/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[],"repository_name":"matrix-architect","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"matrix-architect/Matrix/Architect/Events","kind":"module","full_name":"Matrix::Architect::Events","name":"Events"},"doc":null,"summary":null,"class_methods":[],"constructors":[{"id":"new(room_id,payload:JSON::Any)-class-method","html_id":"new(room_id,payload:JSON::Any)-class-method","name":"new","doc":null,"summary":null,"abstract":false,"args":[{"name":"room_id","doc":null,"default_value":"","external_name":"room_id","restriction":""},{"name":"payload","doc":null,"default_value":"","external_name":"payload","restriction":"JSON::Any"}],"args_string":"(room_id, payload : JSON::Any)","source_link":null,"def":{"name":"new","args":[{"name":"room_id","doc":null,"default_value":"","external_name":"room_id","restriction":""},{"name":"payload","doc":null,"default_value":"","external_name":"payload","restriction":"JSON::Any"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"_ = allocate\n_.initialize(room_id, payload)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"id":"room_id:String-instance-method","html_id":"room_id:String-instance-method","name":"room_id","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : String","source_link":null,"def":{"name":"room_id","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"String","visibility":"Public","body":"@room_id"}}],"macros":[],"types":[]},{"html_id":"matrix-architect/Matrix/Architect/Events/Message","path":"Matrix/Architect/Events/Message.html","kind":"struct","full_name":"Matrix::Architect::Events::Message","name":"Message","abstract":false,"superclass":{"html_id":"matrix-architect/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"matrix-architect/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"matrix-architect/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"matrix-architect/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[],"repository_name":"matrix-architect","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"matrix-architect/Matrix/Architect/Events","kind":"module","full_name":"Matrix::Architect::Events","name":"Events"},"doc":null,"summary":null,"class_methods":[],"constructors":[{"id":"new(payload:JSON::Any)-class-method","html_id":"new(payload:JSON::Any)-class-method","name":"new","doc":null,"summary":null,"abstract":false,"args":[{"name":"payload","doc":null,"default_value":"","external_name":"payload","restriction":"JSON::Any"}],"args_string":"(payload : JSON::Any)","source_link":null,"def":{"name":"new","args":[{"name":"payload","doc":null,"default_value":"","external_name":"payload","restriction":"JSON::Any"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"_ = allocate\n_.initialize(payload)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"id":"body:String-instance-method","html_id":"body:String-instance-method","name":"body","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : String","source_link":null,"def":{"name":"body","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"String","visibility":"Public","body":"@body"}}],"macros":[],"types":[]},{"html_id":"matrix-architect/Matrix/Architect/Events/RoomEvent","path":"Matrix/Architect/Events/RoomEvent.html","kind":"struct","full_name":"Matrix::Architect::Events::RoomEvent","name":"RoomEvent","abstract":false,"superclass":{"html_id":"matrix-architect/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"matrix-architect/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"matrix-architect/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"matrix-architect/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[],"repository_name":"matrix-architect","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"matrix-architect/Matrix/Architect/Events","kind":"module","full_name":"Matrix::Architect::Events","name":"Events"},"doc":null,"summary":null,"class_methods":[],"constructors":[{"id":"new(room_id,payload:JSON::Any)-class-method","html_id":"new(room_id,payload:JSON::Any)-class-method","name":"new","doc":null,"summary":null,"abstract":false,"args":[{"name":"room_id","doc":null,"default_value":"","external_name":"room_id","restriction":""},{"name":"payload","doc":null,"default_value":"","external_name":"payload","restriction":"JSON::Any"}],"args_string":"(room_id, payload : JSON::Any)","source_link":null,"def":{"name":"new","args":[{"name":"room_id","doc":null,"default_value":"","external_name":"room_id","restriction":""},{"name":"payload","doc":null,"default_value":"","external_name":"payload","restriction":"JSON::Any"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"_ = allocate\n_.initialize(room_id, payload)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"id":"message?-instance-method","html_id":"message?-instance-method","name":"message?","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"","source_link":null,"def":{"name":"message?","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"if @payload[\"type\"] == \"m.room.message\"\n  return Message.new(@payload)\nend"}},{"id":"room_id:String-instance-method","html_id":"room_id:String-instance-method","name":"room_id","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : String","source_link":null,"def":{"name":"room_id","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"String","visibility":"Public","body":"@room_id"}},{"id":"sender:String-instance-method","html_id":"sender:String-instance-method","name":"sender","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : String","source_link":null,"def":{"name":"sender","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"String","visibility":"Public","body":"@sender"}}],"macros":[],"types":[]},{"html_id":"matrix-architect/Matrix/Architect/Events/Sync","path":"Matrix/Architect/Events/Sync.html","kind":"struct","full_name":"Matrix::Architect::Events::Sync","name":"Sync","abstract":false,"superclass":{"html_id":"matrix-architect/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"matrix-architect/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"matrix-architect/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"matrix-architect/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[],"repository_name":"matrix-architect","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"matrix-architect/Matrix/Architect/Events","kind":"module","full_name":"Matrix::Architect::Events","name":"Events"},"doc":null,"summary":null,"class_methods":[],"constructors":[{"id":"new(payload:JSON::Any)-class-method","html_id":"new(payload:JSON::Any)-class-method","name":"new","doc":null,"summary":null,"abstract":false,"args":[{"name":"payload","doc":null,"default_value":"","external_name":"payload","restriction":"JSON::Any"}],"args_string":"(payload : JSON::Any)","source_link":null,"def":{"name":"new","args":[{"name":"payload","doc":null,"default_value":"","external_name":"payload","restriction":"JSON::Any"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"_ = allocate\n_.initialize(payload)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"id":"invites(&)-instance-method","html_id":"invites(&)-instance-method","name":"invites","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"(&)","source_link":null,"def":{"name":"invites","args":[],"double_splat":null,"splat_index":null,"yields":1,"block_arg":null,"return_type":"","visibility":"Public","body":"@payload[\"rooms\"][\"invite\"].as_h.each do |room_id, invite|\n  yield Invite.new(room_id, invite)\nend"}},{"id":"room_events(&)-instance-method","html_id":"room_events(&)-instance-method","name":"room_events","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"(&)","source_link":null,"def":{"name":"room_events","args":[],"double_splat":null,"splat_index":null,"yields":1,"block_arg":null,"return_type":"","visibility":"Public","body":"@payload[\"rooms\"][\"join\"].as_h.each do |room_id, room|\n  room[\"timeline\"][\"events\"].as_a.each do |event|\n    yield RoomEvent.new(room_id, event)\n  end\nend"}}],"macros":[],"types":[]}]}]}]}]}})